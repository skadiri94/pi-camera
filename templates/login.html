{% extends 'base.html' %}
{% block content %}

<div class="row">
    <div class="col-md-4 offset-3">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="alert alert-danger">
            {{ messages[0] }}
        </div>
        {% endif %}
        {% endwith %}
    </div>
</div>
<div style="margin-top:30px" class="row">
    <div class="col-md-5 offset-3">
        <form method="post" action="/login">
            <div class="form-group">
                <label for="publickey">Public Key</label>
                <input name="publickey" type="text" class="form-control" id="publickey" placeholder="Public Key">
            </div>
      
            <button type="submit" class="btn btn-primary mb-2">Login</button>
            <a href="{{ url_for('register') }}">
            <button type="button" class="btn btn-primary mb-2" role="button">New User</button>
        </a>
        </form>
    </div>
</div>
<script type="text/javascript">
    var nonce = "";
   fetch('/nonce')
      .then(function (response) {
          return response.json();
      }).then(function (text) {
          console.log('GET response:');
          console.log(text.Message); 
          nonce = text.Message;
      });

  var getAcc = async function () {
  var web3 = new Web3(window.ethereum);
    try {
      const accounts = await window.ethereum.send(
        "eth_requestAccounts"
      );
      const address = accounts.result[0];
      console.log(" @:: ", nonce); 
      const signed_msg = web3.eth.personal.sign(`Singning one-time nonce: ${nonce}`, address);
      console.log('accounts',signed_msg);
     } catch(error){
         alert("Please Install Metamask Wallet");
         console.log('Error',error);
         
     }
    }
    getAcc();
    </script>
{% endblock %}